env.DOCKERHUB_USERNAME='alamgirm'
//env.APPBUILD_ID='16'
pipeline {
    //agent  any
     agent { 
         node { 
             label 'deploymenthost' //Production host node, set as slave in Jenkins 
         } 
     }
    stages {
        // pull the docker image from docker hub
        stage('PullDockerImage') {
            steps {
                  withDockerRegistry([credentialsId: 'dockerhub', url: 'https://hub.docker.com/']) {  
                      //sh "echo $APP_BUILD_ID"
                      sh "docker pull ${DOCKERHUB_USERNAME}/myapp:latest"
                  }
            }
        }
        // run the docker image
        stage('RunDockerImage') { 
            steps {
                sh "docker stop MyApp"
                sh "docker ps -aq --no-trunc | xargs docker rm"
                sh "docker run -d -p 8080:8080 --name=MyApp alamgirm/myapp:latest  /bin/bash" 
            }
        }
    }
}
